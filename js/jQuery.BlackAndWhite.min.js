(function(a){a.fn.extend({BlackAndWhite:function(f){function j(e,b,c,h){var g=b.getContext("2d"),d=0,f;a(e).load(function(){g.drawImage(e,0,0,c,h);var a=g.getImageData(0,0,c,h),b=a.data,i=b.length;if(m&&k)try{var l=new Worker(k+"BnWWorker.js");l.onmessage=function(b){a.data=b.data;g.putImageData(b.data,0,0)};l.postMessage(a)}catch(j){console.log(j)}else{for(;d<i;d+=4)f=0.3*b[d]+0.59*b[d+1]+0.11*b[d+2],b[d]=b[d+1]=b[d+2]=f;g.putImageData(a,0,0)}})}var e=this,f=a.extend({hoverEffect:!0,webworkerPath:!1},
f),i=f.hoverEffect,k=f.webworkerPath,n=!!document.createElement("canvas").getContext,m=function(){return"undefined"!==typeof Worker?!0:!1};this.init=function(){n&&!(jQuery.browser.msie&&"9.0"==jQuery.browser.version)?(a(e).each(function(e,b){var c=a(b).find("img"),h=a(c).prop("src"),g=a(c).prop("width"),d=a(c).prop("height");if(jQuery.browser.opera){var f=Math.random();a(c).prop("src",h+"?"+f)}(!g||!d)&&alert("Set the width and height on your images");a('<canvas width="'+g+'" height="'+d+'"></canvas>').prependTo(b);
h=a(b).find("canvas");a(h).css({position:"absolute",top:0,left:0});j(c[0],h[0],g,d)}),i&&(a(e).mouseenter(function(){a(this).find("canvas").stop(!0,!0).fadeOut()}),a(e).mouseleave(function(){a(this).find("canvas").stop(!0,!0).fadeIn()}))):(a(e).each(function(f,b){var c=a(b).find("img"),e=a(b).find("img").prop("src"),g=a(c).prop("width"),c=a(c).prop("height");(!g||!c)&&alert("Set the width and height on your images");a("<img src="+e+' width="'+g+'" height="'+c+'" class="ieFix" /> ').prependTo(b);a(".ieFix").css({position:"absolute",
top:0,left:0,filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)"})}),i&&(a(e).mouseenter(function(){a(this).children(".ieFix").stop(!0,!0).fadeOut()}),a(e).mouseleave(function(){a(this).children(".ieFix").stop(!0,!0).fadeIn()})))};return this.init(f)}})})(jQuery);